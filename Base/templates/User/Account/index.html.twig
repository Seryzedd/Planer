{% extends 'base.html.twig' %}

{% block title %}My Account{% endblock %}

{% block breadcrumb %}
    {% set content = {
        'Home': 'app_index',
        'Account': 'my_account'
        } %}

    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-12"><h1 class="text-primary text-right">My account</h1></div>
        {{ block('Main_informations') }}
    </div>
{% endblock %}

{% block Main_informations %}
    <div class="col-lg-4 col-12">
        <div class="sticky-top bg-light rounded p-4" style="z-index: 10;">
            <p class="text-right mb-0"><a href="{{ path('user_update') }}" class="btn btn-light rounded-circle"><i class="fas fa-pen"></i></a></p>
            <h2 class="text-primary text-center">Logged as {{ app.user.username }}</h2>
            <h3 class='mb-0  text-center'>{{ app.user.firstName }} {{ app.user.lastName }}</h3>
            <p class='mb-0 font-weight-bold text-center {% if not app.user.email %}text-muted{% endif %}'>{{ app.user.email ?: "Empty email" }}</p>
            
            {% if app.user.roles|length > 0 %}
                <p class="mb-0 py-2 text-center">
                    {% for role in app.user.roles %}
                        <span class="px-2 py-1 bg-secondary rounded mx-1">{{ role|replace({'_': ' '})|replace({'ROLE': ''})|lower }}</span>
                    {% endfor %}
                </p>
            {% endif %}

            {% if app.user.team %}
                <p class='mb-0 text-center'>
                   <a href="#team_part" class="btn btn-light"> My team <span class="font-weight-bold">{{ app.user.team.name }}</span></a>
                   <a href="#calendar_part" class="btn btn-light">My calendar</a>
                   <a href="#shedules_part" class="btn btn-light">My schedules</a>
                   <a href="#absences_part" class="btn btn-light">My absences</a>
                </p>
            {% endif %}
            
        </div>
    </div>

    <div class="col-lg-8 col-12 pt-lg-4">
        <h2 class="text-secondary line-secondary mb-3" id="calendar_part">
            <span>My calendar</span>
        </h2>
        {% include "Calendar/view.html.twig" with {'users': [app.user], 'showUsers': false} %}

        <h2 class="text-secondary line-secondary mb-3 d-flex justify-content-between" id="shedules_part">
            <span>My Schedules</span>
            <a href="{{ path('new_schedule') }}" class="btn btn-light"><i class="fas fa-pen mr-2"></i>Update</a>
        </h2>

        {% include "User/Account/scheduleView.html.twig" with {'user': app.user} %}

        <h2 class="text-secondary line-secondary mb-3 mt-2 d-flex justify-content-between" id="absences_part">
            <span>My Absences</span>
            <a href="{{ path('new_absence') }}" class="btn btn-light">Create absence</a>
        </h2>
        <div class="">

            <div class="row">
                {% for absence in app.user.absences %}
                    <div class='col-4'>
                        <a href="{{ path('absence_update', {'id': absence.id}) }}" class="btn btn-light btn-block">
                            <p class="text-center text-primary font-weight-bold">{{ absence.type }}</p>
                            <p class="text-dark">{{ absence.from|date('d/m/Y') }} <i class="fas fa-arrow-right"></i> {{ absence.to|date('d/m/Y') }}</p>
                        </a>
                    </div>
                {% endfor %}

                {% if app.user.absences|length == 0 %}
                    <h3 class="text-muted text-center col-12">No absence created</p>
                {% endif %}
            </div>
            
        </div>

        {% if app.user.team %}
            <h2 class="text-secondary line-secondary mb-3 mt-2 d-flex justify-content-between" id="team_part">
                <span>My Team {{ app.user.team.name|upper }}</span>
            </h2>

            <div class="px-4">
                <p class="text-right">Leader : <span class="font-weight-bold text-primary">{{ app.user.team.lead.userName }}</span></p>
                {% for user in app.user.team.users %}
                    <div class='row rounded bg-light'>
                        <div class="col-lg-2 col-6 p-2">
                            <p class="mb-0 text-primary font-weight-bold">{{ user.userName }}</p>
                        </div>

                        <div class="col-lg-4 col-6 p-2">
                            <p class="mb-0">{{ user.firstName }} {{ user.lastName }}</p>
                        </div>
                        <div class="col-4 col-lg-4 p-2">
                            <p class="mb-0">{{ user.email }}</p>
                        </div>

                        <div class="col-6 col-lg-2 text-center p-1">
                            <p class="mb-0 text-secondary-reverse bg-secondary p-1 rounded">{{ user.job }}</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
    </div>
{% endblock %}